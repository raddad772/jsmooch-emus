
// Auto-generated by spc700_core_generator.js SPC_decode_opcodes_c()
#include "spc700.h"


namespace SPC700 {


static void opcode_00(core &cpu) { // NOP 
    cpu.regs.opc_cycles = 2;
    // INS 44 ADDR MODE 0
}


static void opcode_01(core &cpu) { // TCALL 0
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65502);
    cpu.regs.PC |= cpu.read8(65503) << 8;
}


static void opcode_02(core &cpu) { // SET1 dp.0
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x01;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_03(core &cpu) { // BBS dp.0, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 1) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_04(core &cpu) { // OR A, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_05(core &cpu) { // OR A, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_06(core &cpu) { // OR A, (X)
    cpu.regs.opc_cycles = 3;
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_07(core &cpu) { // OR A, [dp+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_08(core &cpu) { // OR A, #
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_09(core &cpu) { // OR dp, dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TR);
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 47 ADDR MODE undefined
    cpu.regs.TA2 |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.regs.P.N = ((cpu.regs.TA2) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_0A(core &cpu) { // OR1 C, m.b
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA = cpu.read8(cpu.regs.TA & 0x1FFF);
    // INS 48 ADDR MODE 17
    u32 mask = 1 << cpu.regs.TR;
    u32 val = (cpu.regs.TA & mask) >> cpu.regs.TR;
    val &= 0x01;
    cpu.regs.P.C |= val;
}


static void opcode_0B(core &cpu) { // ASL d
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 5 ADDR MODE undefined
    cpu.regs.P.C = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.regs.TR = (cpu.regs.TR << 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_0C(core &cpu) { // ASL !abs
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 5 ADDR MODE undefined
    cpu.regs.P.C = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.regs.TR = (cpu.regs.TR << 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_0D(core &cpu) { // PUSH P
    cpu.regs.opc_cycles = 4;
    // INS 51 ADDR MODE null
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.P.v & 0xFF));
    cpu.regs.SP &= 0xFF;
}


static void opcode_0E(core &cpu) { // TSET1 !abs
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 65 ADDR MODE undefined
    cpu.regs.P.Z = +((cpu.regs.A - cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.A - cpu.regs.TR) & 0x80) >> 7;
    cpu.regs.TR |= cpu.regs.A;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_0F(core &cpu) { // BRK i
    cpu.regs.opc_cycles = 8;
    // INS 17 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, cpu.regs.PC & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.P.v & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.P.I = 0;
    cpu.regs.P.B = 1;
    cpu.regs.PC = cpu.read8((0xFFDE) & 0xFFFF) + (cpu.read8(((0xFFDE) + 1) & 0xFFFF) << 8);
}


static void opcode_10(core &cpu) { // BPL r
    cpu.regs.opc_cycles = 2;
    // INS 13 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (!cpu.regs.P.N) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_11(core &cpu) { // TCALL i
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65500);
    cpu.regs.PC |= cpu.read8(65501) << 8;
}


static void opcode_12(core &cpu) { // CLR1 dp.0
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0xFE;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_13(core &cpu) { // BBC dp.0
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 1) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_14(core &cpu) { // OR A, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_15(core &cpu) { // OR A, !abs+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_16(core &cpu) { // OR A, !abs+Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_17(core &cpu) { // OR A, [dp]+Y
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 47 ADDR MODE undefined
    cpu.regs.A |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_18(core &cpu) { // OR dp, #imm
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 47 ADDR MODE undefined
    cpu.regs.TA2 |= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.regs.P.N = ((cpu.regs.TA2) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_19(core &cpu) { // OR (X), (Y)
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8D(cpu.regs.Y);
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 47 ADDR MODE undefined
    cpu.regs.TR |= cpu.regs.TA;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.X), cpu.regs.TR);
}


static void opcode_1A(core &cpu) { // DECW dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    // INS 30 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR - 1) & 0xFFFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = (cpu.regs.TR & 0x8000) >> 15;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR & 0xFF);
    cpu.write8D((cpu.regs.TA) + 1, ((cpu.regs.TR) >> 8) & 0xFF);
}


static void opcode_1B(core &cpu) { // ASL dp+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 5 ADDR MODE undefined
    cpu.regs.P.C = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.regs.TR = (cpu.regs.TR << 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_1C(core &cpu) { // ASL A
    cpu.regs.opc_cycles = 2;
    // INS 5 ADDR MODE undefined
    cpu.regs.P.C = ((cpu.regs.A) & 0x80) >> 7;
    cpu.regs.A = (cpu.regs.A << 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_1D(core &cpu) { // DEC X
    cpu.regs.opc_cycles = 2;
    // INS 29 ADDR MODE undefined
    cpu.regs.X = (cpu.regs.X - 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_1E(core &cpu) { // CMP X, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.X - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_1F(core &cpu) { // JMP [!abs+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = (cpu.regs.TA + cpu.regs.X) & 0xFFFF;
    cpu.regs.TR = cpu.read8((cpu.regs.TA) & 0xFFFF) + (cpu.read8(((cpu.regs.TA) + 1) & 0xFFFF) << 8);
    // INS 38 ADDR MODE undefined
    cpu.regs.PC = cpu.regs.TR;
}


static void opcode_20(core &cpu) { // CLRP i
    cpu.regs.opc_cycles = 2;
    // INS 22 ADDR MODE 0
    cpu.regs.P.P = 0;
    cpu.regs.P.DO = 0;
}


static void opcode_21(core &cpu) { // TCALL 2
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65498);
    cpu.regs.PC |= cpu.read8(65499) << 8;
}


static void opcode_22(core &cpu) { // SET1 dp.1
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x02;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_23(core &cpu) { // BBS dp.1, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 2) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_24(core &cpu) { // AND A, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_25(core &cpu) { // AND A, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_26(core &cpu) { // AND A, (X)
    cpu.regs.opc_cycles = 3;
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_27(core &cpu) { // AND A, [dp+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_28(core &cpu) { // AND A, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_29(core &cpu) { // AND dp, dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TR);
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 3 ADDR MODE undefined
    cpu.regs.TA2 &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.regs.P.N = ((cpu.regs.TA2) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_2A(core &cpu) { // OR1 C, /m.b
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA = cpu.read8(cpu.regs.TA & 0x1FFF);
    // INS 4801 ADDR MODE 17
    u32 mask = 1 << cpu.regs.TR;
    u32 val = (cpu.regs.TA & mask) >> cpu.regs.TR;
    val &= 0x01;
    cpu.regs.P.C |= (val ? 0 : 1);
}


static void opcode_2B(core &cpu) { // ROL dp
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 54 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = (cpu.regs.TR & 0x80) >> 7;
    cpu.regs.TR = ((cpu.regs.TR << 1) | carry) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_2C(core &cpu) { // ROL !abs
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 54 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = (cpu.regs.TR & 0x80) >> 7;
    cpu.regs.TR = ((cpu.regs.TR << 1) | carry) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_2D(core &cpu) { // PUSH A
    cpu.regs.opc_cycles = 4;
    // INS 51 ADDR MODE null
    cpu.write8(0x100 + cpu.regs.SP--, cpu.regs.A);
    cpu.regs.SP &= 0xFF;
}


static void opcode_2E(core &cpu) { // CBNE dp, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    // INS 19 ADDR MODE undefined
    if (cpu.regs.A != cpu.regs.TA) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_2F(core &cpu) { // BRA r
    cpu.regs.opc_cycles = 2;
    // INS 16 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
    cpu.regs.opc_cycles += 2;
}


static void opcode_30(core &cpu) { // BMI r
    cpu.regs.opc_cycles = 2;
    // INS 11 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.P.N) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_31(core &cpu) { // TCALL 3
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65496);
    cpu.regs.PC |= cpu.read8(65497) << 8;
}


static void opcode_32(core &cpu) { // CLR1 dp.1
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0xFD;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_33(core &cpu) { // BBC dp.1
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 2) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_34(core &cpu) { // AND A, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_35(core &cpu) { // AND A, !abs+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_36(core &cpu) { // AND A, !abs+Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_37(core &cpu) { // AND A, [dp]+Y
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 3 ADDR MODE undefined
    cpu.regs.A &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_38(core &cpu) { // AND dp, #imm
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 3 ADDR MODE undefined
    cpu.regs.TA2 &= (cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.regs.P.N = ((cpu.regs.TA2) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_39(core &cpu) { // AND (X), (Y)
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8D(cpu.regs.Y);
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 3 ADDR MODE undefined
    cpu.regs.TR &= (cpu.regs.TA);
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.X), cpu.regs.TR);
}


static void opcode_3A(core &cpu) { // INCW dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    // INS 37 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR + 1) & 0xFFFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = (cpu.regs.TR & 0x8000) >> 15;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR & 0xFF);
    cpu.write8D((cpu.regs.TA) + 1, ((cpu.regs.TR) >> 8) & 0xFF);
}


static void opcode_3B(core &cpu) { // ROL dp+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 54 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = (cpu.regs.TR & 0x80) >> 7;
    cpu.regs.TR = ((cpu.regs.TR << 1) | carry) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_3C(core &cpu) { // ROL A
    cpu.regs.opc_cycles = 2;
    // INS 54 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = (cpu.regs.A & 0x80) >> 7;
    cpu.regs.A = ((cpu.regs.A << 1) | carry) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_3D(core &cpu) { // INC X
    cpu.regs.opc_cycles = 2;
    // INS 36 ADDR MODE undefined
    cpu.regs.X = (cpu.regs.X + 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_3E(core &cpu) { // CMP X, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.X - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_3F(core &cpu) { // CALL !abs
    cpu.regs.opc_cycles = 8;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    // INS 18 ADDR MODE undefined
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.regs.TA;
}


static void opcode_40(core &cpu) { // SETP i
    cpu.regs.opc_cycles = 2;
    // INS 59 ADDR MODE 0
    cpu.regs.P.P = 1;
    cpu.regs.P.DO = 0x100;
}


static void opcode_41(core &cpu) { // TCALL 4
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65494);
    cpu.regs.PC |= cpu.read8(65495) << 8;
}


static void opcode_42(core &cpu) { // SET1 dp.2
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x04;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_43(core &cpu) { // BBS dp.2, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 4) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_44(core &cpu) { // EOR A, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_45(core &cpu) { // EOR A, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_46(core &cpu) { // EOR A, (X)
    cpu.regs.opc_cycles = 3;
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_47(core &cpu) { // EOR A, [dp+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_48(core &cpu) { // EOR A, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_49(core &cpu) { // EOR dp, dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TR);
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 34 ADDR MODE undefined
    cpu.regs.TA2 ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.regs.P.N = ((cpu.regs.TA2) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_4A(core &cpu) { // AND1 m.b
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA = cpu.read8(cpu.regs.TA & 0x1FFF);
    // INS 4 ADDR MODE 17
    u32 mask = 1 << cpu.regs.TR;
    u32 val = (cpu.regs.TA & mask) >> cpu.regs.TR;
    val &= 0x01;
    cpu.regs.P.C &= val;
}


static void opcode_4B(core &cpu) { // LSR dp
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 39 ADDR MODE undefined
    cpu.regs.P.C = (cpu.regs.TR) & 0x01;
    cpu.regs.TR >>= 1;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_4C(core &cpu) { // LSR !abs
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 39 ADDR MODE undefined
    cpu.regs.P.C = (cpu.regs.TR) & 0x01;
    cpu.regs.TR >>= 1;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_4D(core &cpu) { // PUSH X
    cpu.regs.opc_cycles = 4;
    // INS 51 ADDR MODE null
    cpu.write8(0x100 + cpu.regs.SP--, cpu.regs.X);
    cpu.regs.SP &= 0xFF;
}


static void opcode_4E(core &cpu) { // TCLR1 !abs
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 64 ADDR MODE undefined
    cpu.regs.P.Z = +((cpu.regs.A - cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.A - cpu.regs.TR) & 0x80) >> 7;
    cpu.regs.TR &= (~cpu.regs.A) & 0xFF;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_4F(core &cpu) { // PCALL #imm
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 49 ADDR MODE undefined
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.regs.TR + 0xFF00;
}


static void opcode_50(core &cpu) { // BVC r
    cpu.regs.opc_cycles = 2;
    // INS 14 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (!cpu.regs.P.V) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_51(core &cpu) { // TCALL 5
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65492);
    cpu.regs.PC |= cpu.read8(65493) << 8;
}


static void opcode_52(core &cpu) { // CLR1 dp.2
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0xFB;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_53(core &cpu) { // BBC dp.2
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 0x04) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_54(core &cpu) { // EOR A, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_55(core &cpu) { // EOR A, !abs+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_56(core &cpu) { // EOR A, !abs+Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_57(core &cpu) { // EOR A, [dp]+Y
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 34 ADDR MODE undefined
    cpu.regs.A ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_58(core &cpu) { // EOR dp, #imm
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 34 ADDR MODE undefined
    cpu.regs.TA2 ^= cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.regs.P.N = ((cpu.regs.TA2) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_59(core &cpu) { // EOR (X), (Y)
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8D(cpu.regs.Y);
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 34 ADDR MODE undefined
    cpu.regs.TR ^= cpu.regs.TA;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.X), cpu.regs.TR);
}


static void opcode_5A(core &cpu) { // CMPW 
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TA = cpu.read8D(cpu.regs.TA+1);
    cpu.regs.TR += (cpu.regs.TA << 8);
    // INS 25 ADDR MODE undefined
    i32 z = ((cpu.regs.Y << 8) + cpu.regs.A) - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFFFF) == 0);
    cpu.regs.P.N = (z & 0x8000) >> 15;
}


static void opcode_5B(core &cpu) { // LSR dp+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 39 ADDR MODE undefined
    cpu.regs.P.C = (cpu.regs.TR) & 0x01;
    cpu.regs.TR >>= 1;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_5C(core &cpu) { // LSR A
    cpu.regs.opc_cycles = 2;
    // INS 39 ADDR MODE undefined
    cpu.regs.P.C = (cpu.regs.A) & 0x01;
    cpu.regs.A >>= 1;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_5D(core &cpu) { // MOV X, A
    cpu.regs.opc_cycles = 2;
    cpu.regs.X = cpu.regs.A;
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_5E(core &cpu) { // CMP Y, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.Y - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_5F(core &cpu) { // JMP !abs
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.PC = cpu.regs.TA;
}


static void opcode_60(core &cpu) { // CLRC i
    cpu.regs.opc_cycles = 2;
    // INS 21 ADDR MODE 0
    cpu.regs.P.C = 0;
}


static void opcode_61(core &cpu) { // TCALL 6
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65490);
    cpu.regs.PC |= cpu.read8(65491) << 8;
}


static void opcode_62(core &cpu) { // SET1 dp.3
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x08;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_63(core &cpu) { // BBS dp.3, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 8) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_64(core &cpu) { // CMP A, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_65(core &cpu) { // CMP A, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_66(core &cpu) { // CMP A, (X)
    cpu.regs.opc_cycles = 3;
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_67(core &cpu) { // CMP A, [dp+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_68(core &cpu) { // CMP A, #i
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_69(core &cpu) { // CMP dp, dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TR);
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.TA2 - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_6A(core &cpu) { // AND1 C, /m.b
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA = cpu.read8(cpu.regs.TA & 0x1FFF);
    // INS 401 ADDR MODE 17
    u32 mask = 1 << cpu.regs.TR;
    u32 val = (cpu.regs.TA & mask) >> cpu.regs.TR;
    val = (~val) & 0x01;
    cpu.regs.P.C &= val;
}


static void opcode_6B(core &cpu) { // ROR dp
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 55 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = cpu.regs.TR& 1;
    cpu.regs.TR = (carry << 7) | (cpu.regs.TR >> 1);
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_6C(core &cpu) { // ROR !abs
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 55 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = cpu.regs.TR& 1;
    cpu.regs.TR = (carry << 7) | (cpu.regs.TR >> 1);
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_6D(core &cpu) { // PUSH Y
    cpu.regs.opc_cycles = 4;
    // INS 51 ADDR MODE null
    cpu.write8(0x100 + cpu.regs.SP--, cpu.regs.Y);
    cpu.regs.SP &= 0xFF;
}


static void opcode_6E(core &cpu) { // DBNZ dp, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 28 ADDR MODE undefined
    cpu.regs.TA2 = (cpu.regs.TA2 - 1) & 0xFF;
    if (cpu.regs.TA2 != 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_6F(core &cpu) { // RET i
    cpu.regs.opc_cycles = 5;
    // INS 52 ADDR MODE 0
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.PC = cpu.read8(0x100 + cpu.regs.SP);
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.PC += cpu.read8(0x100 + cpu.regs.SP) << 8;
}


static void opcode_70(core &cpu) { // BVS r
    cpu.regs.opc_cycles = 2;
    // INS 15 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.P.V) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_71(core &cpu) { // TCALL 7
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65488);
    cpu.regs.PC |= cpu.read8(65489) << 8;
}


static void opcode_72(core &cpu) { // CLR1 dp.3
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0xF7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_73(core &cpu) { // BBC dp.3
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 0x08) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_74(core &cpu) { // CMP A, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_75(core &cpu) { // CMP A, !abs+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_76(core &cpu) { // CMP A, !abs+Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_77(core &cpu) { // CMP A, [dp]+Y
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.A - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_78(core &cpu) { // CMP dp, #imm
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.TA2 - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_79(core &cpu) { // CMP (X), (Y)
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8D(cpu.regs.Y);
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.TR - cpu.regs.TA;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_7A(core &cpu) { // ADDW YA, dp
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TA = cpu.read8D(cpu.regs.TA+1);
    cpu.regs.TR += (cpu.regs.TA << 8);
    // INS 2 ADDR MODE undefined
    u32 z;
    cpu.regs.P.C = 0;
    u32 y = cpu.regs.TR & 0xFF;
    z = cpu.regs.A + y;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.A = z & 0xFF;
    y = (cpu.regs.TR >> 8) & 0xFF;
    z = cpu.regs.Y + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = ((cpu.regs.Y ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~(cpu.regs.Y ^ y)) & (cpu.regs.Y ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.Y = z & 0xFF;
    cpu.regs.P.Z = +(cpu.regs.A == 0 && cpu.regs.Y == 0);
}


static void opcode_7B(core &cpu) { // ROR dp+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 55 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = cpu.regs.TR& 1;
    cpu.regs.TR = (carry << 7) | (cpu.regs.TR >> 1);
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_7C(core &cpu) { // ROR A
    cpu.regs.opc_cycles = 2;
    // INS 55 ADDR MODE undefined
    u32 carry = cpu.regs.P.C;
    cpu.regs.P.C = cpu.regs.A& 1;
    cpu.regs.A = (carry << 7) | (cpu.regs.A >> 1);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_7D(core &cpu) { // MOV A, X
    cpu.regs.opc_cycles = 2;
    cpu.regs.A = cpu.regs.X;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_7E(core &cpu) { // CMP Y, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.Y - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_7F(core &cpu) { // RET1 i
    cpu.regs.opc_cycles = 6;
    // INS 53 ADDR MODE 0
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.TR = cpu.read8(0x100 + cpu.regs.SP);
    cpu.regs.P.setbyte(cpu.regs.TR);
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.PC = cpu.read8(0x100 + cpu.regs.SP);
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.PC += cpu.read8(0x100 + cpu.regs.SP) << 8;
}


static void opcode_80(core &cpu) { // SETC i
    cpu.regs.opc_cycles = 2;
    // INS 58 ADDR MODE 0
    cpu.regs.P.C = 1;
}


static void opcode_81(core &cpu) { // TCALL 8
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65486);
    cpu.regs.PC |= cpu.read8(65487) << 8;
}


static void opcode_82(core &cpu) { // SET1 dp.4
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x10;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_83(core &cpu) { // BBS dp.4, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 0x10) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_84(core &cpu) { // ADC A, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_85(core &cpu) { // ADC !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_86(core &cpu) { // ADC A, (X)
    cpu.regs.opc_cycles = 3;
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_87(core &cpu) { // ADC A, [dp+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_88(core &cpu) { // ADC A, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_89(core &cpu) { // ADC dp, dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TR);
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.TA2) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.TA2) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.TA2) ^ (cpu.regs.TR ))) & ((cpu.regs.TA2) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.TA2 = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_8A(core &cpu) { // EOR1 C, m.b
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA = cpu.read8(cpu.regs.TA & 0x1FFF);
    // INS 35 ADDR MODE 17
    u32 mask = 1 << cpu.regs.TR;
    u32 val = (cpu.regs.TA & mask) >> cpu.regs.TR;
    val &= 0x01;
    cpu.regs.P.C ^= val;
}


static void opcode_8B(core &cpu) { // DEC dp
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 29 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR - 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_8C(core &cpu) { // DEC !abs
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 29 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR - 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_8D(core &cpu) { // MOV Y, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.Y = cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_8E(core &cpu) { // POP P
    cpu.regs.opc_cycles = 4;
    // INS 50 ADDR MODE null
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.TR = cpu.read8(0x100 + cpu.regs.SP);
    cpu.regs.P.setbyte(cpu.regs.TR);
}


static void opcode_8F(core &cpu) { // MOV d, #imm
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_90(core &cpu) { // BCC r
    cpu.regs.opc_cycles = 2;
    // INS 8 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (!cpu.regs.P.C) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_91(core &cpu) { // TCALL 9
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65484);
    cpu.regs.PC |= cpu.read8(65485) << 8;
}


static void opcode_92(core &cpu) { // CLR1 dp.4
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0xEF;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_93(core &cpu) { // BBC dp.4
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 0x10) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_94(core &cpu) { // ADC A, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_95(core &cpu) { // ADC A, !abs+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_96(core &cpu) { // ADC A, !abs+Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_97(core &cpu) { // ADC A, [dp]+Y
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.A) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ (cpu.regs.TR ))) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_98(core &cpu) { // ADC dp, #imm
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.TA2) + (cpu.regs.TR) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.TA2) ^ (cpu.regs.TR) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.TA2) ^ (cpu.regs.TR ))) & ((cpu.regs.TA2) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.TA2 = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_99(core &cpu) { // ADC (X), (Y)
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8D(cpu.regs.Y);
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 1 ADDR MODE undefined
    u32 z = (cpu.regs.TR) + (cpu.regs.TA) + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.TR) ^ (cpu.regs.TA) ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.TR) ^ (cpu.regs.TA ))) & ((cpu.regs.TR) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.TR = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.write8D((cpu.regs.X), cpu.regs.TR);
}


static void opcode_9A(core &cpu) { // SUBW YA, dp
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TA = cpu.read8D(cpu.regs.TA+1);
    cpu.regs.TR += (cpu.regs.TA << 8);
    // INS 62 ADDR MODE undefined
    cpu.regs.P.C = 1;
    u32 x, y, z;
    x = cpu.regs.A;
    y = (~cpu.regs.TR) & 0xFF;
    z = (x & 0xFF) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    x = cpu.regs.Y;
    cpu.regs.A = z & 0xFF;
    y = ((~cpu.regs.TR) >> 8) & 0xFF;
    z = (x & 0xFF) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = ((x ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~(x ^ y)) & (x ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.Y = z & 0xFF;
    cpu.regs.P.Z = +(cpu.regs.Y == 0 && cpu.regs.A == 0);
}


static void opcode_9B(core &cpu) { // DEC dp+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 29 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR - 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_9C(core &cpu) { // DEC A
    cpu.regs.opc_cycles = 2;
    // INS 29 ADDR MODE undefined
    cpu.regs.A = (cpu.regs.A - 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_9D(core &cpu) { // MOV X, SP
    cpu.regs.opc_cycles = 2;
    cpu.regs.X = cpu.regs.SP;
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_9E(core &cpu) { // DIV YA, X
    cpu.regs.opc_cycles = 12;
    u32 YA = (cpu.regs.Y << 8) + cpu.regs.A;
    cpu.regs.P.H = +((cpu.regs.Y & 15) >= (cpu.regs.X & 15));
    cpu.regs.P.V = +(cpu.regs.Y >= cpu.regs.X);
    if (cpu.regs.Y < (cpu.regs.X << 1)) {
        cpu.regs.A = (YA / cpu.regs.X) & 0xFF;
        cpu.regs.Y = (YA % cpu.regs.X) & 0xFF;
    } else {
        cpu.regs.A = (255 - ((YA - (cpu.regs.X << 9)) / (256 - cpu.regs.X))) & 0xFF;
        cpu.regs.Y = (cpu.regs.X + (YA - (cpu.regs.X << 9)) % (256 - cpu.regs.X)) & 0xFF;
    }
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_9F(core &cpu) { // XCN i
    cpu.regs.opc_cycles = 5;
    // INS 66 ADDR MODE 0
    cpu.regs.A = ((cpu.regs.A << 4) | (cpu.regs.A >> 4)) & 0xFF;
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_A0(core &cpu) { // EI i
    cpu.regs.opc_cycles = 3;
    // INS 33 ADDR MODE 0
    cpu.regs.P.I = 1;
}


static void opcode_A1(core &cpu) { // TCALL 10
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65482);
    cpu.regs.PC |= cpu.read8(65483) << 8;
}


static void opcode_A2(core &cpu) { // SET1 dp.5
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x20;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_A3(core &cpu) { // BBS dp.5, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 0x20) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_A4(core &cpu) { // SBC A, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_A5(core &cpu) { // SBC A, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_A6(core &cpu) { // SBC A, (X)
    cpu.regs.opc_cycles = 3;
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_A7(core &cpu) { // SBC A, [dp+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_A8(core &cpu) { // SBC A, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_A9(core &cpu) { // SBC dp, dp
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TR);
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.TA2) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.TA2) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.TA2) ^ y)) & ((cpu.regs.TA2) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.TA2 = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_AA(core &cpu) { // MOV1 C, m.b
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA = cpu.read8(cpu.regs.TA & 0x1FFF);
    // INS 41 ADDR MODE 17
    cpu.regs.P.C = ((cpu.regs.TA) >> (cpu.regs.TR)) & 1;
}


static void opcode_AB(core &cpu) { // INC dp
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 36 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR + 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_AC(core &cpu) { // INC !abs
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 36 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR + 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8(cpu.regs.TA, cpu.regs.TR);
}


static void opcode_AD(core &cpu) { // CMP Y, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.Y - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_AE(core &cpu) { // POP A
    cpu.regs.opc_cycles = 4;
    // INS 50 ADDR MODE null
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.A = cpu.read8(0x100 + cpu.regs.SP);
}


static void opcode_AF(core &cpu) { // MOV (X)+, A
    cpu.regs.opc_cycles = 4;
    cpu.write8D((cpu.regs.X), cpu.regs.A);
    cpu.regs.X = (cpu.regs.X + 1) & 0xFF;
}


static void opcode_B0(core &cpu) { // BCS r
    cpu.regs.opc_cycles = 2;
    // INS 9 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.P.C) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_B1(core &cpu) { // TCALL 11
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65480);
    cpu.regs.PC |= cpu.read8(65481) << 8;
}


static void opcode_B2(core &cpu) { // CLR1 dp.5
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0xDF;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_B3(core &cpu) { // BBC dp.5
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 0x20) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_B4(core &cpu) { // SBC A, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_B5(core &cpu) { // SBC A, !abs+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_B6(core &cpu) { // SBC A, !abs+Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA & 0xFFFF);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_B7(core &cpu) { // SBC A, [dp]+Y
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.regs.TA += cpu.regs.Y;
    cpu.regs.TR = cpu.read8(cpu.regs.TA);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.A) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.A) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.A) ^ y)) & ((cpu.regs.A) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.A = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
}


static void opcode_B8(core &cpu) { // SBC dp, #imm
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D(cpu.regs.TA);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TR) & 0xFF;
    i32 z = (cpu.regs.TA2) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.TA2) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.TA2) ^ y)) & ((cpu.regs.TA2) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.TA2 = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TA2) == 0);
    cpu.write8D((cpu.regs.TA), cpu.regs.TA2);
}


static void opcode_B9(core &cpu) { // SBC (X), (Y)
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8D(cpu.regs.Y);
    cpu.regs.TR = cpu.read8D(cpu.regs.X);
    // INS 56 ADDR MODE undefined
    i32 y = (~cpu.regs.TA) & 0xFF;
    i32 z = (cpu.regs.TR) + y + cpu.regs.P.C;
    cpu.regs.P.C = +(z > 0xFF);
    cpu.regs.P.H = (((cpu.regs.TR) ^ y ^ z) & 0x10) >> 4;
    cpu.regs.P.V = (((~((cpu.regs.TR) ^ y)) & ((cpu.regs.TR) ^ z)) & 0x80) >> 7;
    cpu.regs.P.N = (z & 0x80) >> 7;
    cpu.regs.TR = z & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.write8D((cpu.regs.X), cpu.regs.TR);
}


static void opcode_BA(core &cpu) { // MOVW YA, dp
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.A = cpu.read8D(cpu.regs.TA);
    cpu.regs.Y = cpu.read8D(cpu.regs.TA + 1);
    cpu.regs.P.N = (cpu.regs.Y & 0x80) >> 7;
    cpu.regs.P.Z = (!cpu.regs.A && !cpu.regs.Y);
}


static void opcode_BB(core &cpu) { // INC dp+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    // INS 36 ADDR MODE undefined
    cpu.regs.TR = (cpu.regs.TR + 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.TR) == 0);
    cpu.regs.P.N = ((cpu.regs.TR) & 0x80) >> 7;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_BC(core &cpu) { // INC A
    cpu.regs.opc_cycles = 2;
    // INS 36 ADDR MODE undefined
    cpu.regs.A = (cpu.regs.A + 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_BD(core &cpu) { // MOV SP, X
    cpu.regs.opc_cycles = 2;
    cpu.regs.SP = cpu.regs.X;
}


static void opcode_BE(core &cpu) { // DAS A
    cpu.regs.opc_cycles = 3;
    // INS 27 ADDR MODE 0
    if (!cpu.regs.P.C || cpu.regs.A > 0x99) {
        cpu.regs.A -= 0x60;
        cpu.regs.P.C = 0;
    }
    if (!cpu.regs.P.H || ((cpu.regs.A & 15) > 0x09)) {
        cpu.regs.A -= 0x06;
    }
    cpu.regs.A &= 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_BF(core &cpu) { // MOV A, (X)+
    cpu.regs.opc_cycles = 4;
    cpu.regs.A = cpu.read8D(cpu.regs.X);
    cpu.regs.X = (cpu.regs.X + 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_C0(core &cpu) { // DI 
    cpu.regs.opc_cycles = 3;
    // INS 31 ADDR MODE 0
    cpu.regs.P.I = 0;
}


static void opcode_C1(core &cpu) { // TCALL 12
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65478);
    cpu.regs.PC |= cpu.read8(65479) << 8;
}


static void opcode_C2(core &cpu) { // SET1 dp.6
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x40;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_C3(core &cpu) { // BBS dp.6, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 0x40) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_C4(core &cpu) { // MOV d, A
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA), cpu.regs.A);
}


static void opcode_C5(core &cpu) { // MOV !abs, A
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.write8(cpu.regs.TA, cpu.regs.A);
}


static void opcode_C6(core &cpu) { // MOV (X), A
    cpu.regs.opc_cycles = 4;
    cpu.write8D((cpu.regs.X), cpu.regs.A);
}


static void opcode_C7(core &cpu) { // MOV [dp+X], A
    cpu.regs.opc_cycles = 7;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.regs.TA = cpu.read8D((cpu.regs.TA)) + (cpu.read8D((cpu.regs.TA) + 1) << 8);
    cpu.write8(cpu.regs.TA, cpu.regs.A);
}


static void opcode_C8(core &cpu) { // CMP X, #i
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 24 ADDR MODE undefined
    i32 z = cpu.regs.X - cpu.regs.TR;
    cpu.regs.P.C = +(z >= 0);
    cpu.regs.P.Z = +((z & 0xFF) == 0);
    cpu.regs.P.N = (z & 0x80) >> 7;
}


static void opcode_C9(core &cpu) { // MOV !abs, X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.write8(cpu.regs.TA, cpu.regs.X);
}


static void opcode_CA(core &cpu) { // MOV1 m.b, C
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA &= 0x1FFF;
    cpu.regs.TA2 = cpu.read8(cpu.regs.TA);
    // INS 41 ADDR MODE 1
    cpu.regs.TA2 = cpu.regs.P.C ? cpu.regs.TA2 | (cpu.regs.P.C << cpu.regs.TR) : cpu.regs.TA2 & ((~(1 << cpu.regs.TR)) & 0xFF);
    cpu.write8(cpu.regs.TA, cpu.regs.TA2);
}


static void opcode_CB(core &cpu) { // MOV d, Y
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA), cpu.regs.Y);
}


static void opcode_CC(core &cpu) { // MOV !a, Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.write8(cpu.regs.TA, cpu.regs.Y);
}


static void opcode_CD(core &cpu) { // MOV X, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.X = cpu.regs.TR;
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_CE(core &cpu) { // POP X
    cpu.regs.opc_cycles = 4;
    // INS 50 ADDR MODE null
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.X = cpu.read8(0x100 + cpu.regs.SP);
}


static void opcode_CF(core &cpu) { // MUL YA
    cpu.regs.opc_cycles = 9;
    u32 YA = cpu.regs.Y * cpu.regs.A;
    cpu.regs.A = YA & 0xFF;
    cpu.regs.Y = (YA >> 8) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_D0(core &cpu) { // BNE r
    cpu.regs.opc_cycles = 2;
    // INS 12 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (!cpu.regs.P.Z) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_D1(core &cpu) { // TCALL 13
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65476);
    cpu.regs.PC |= cpu.read8(65477) << 8;
}


static void opcode_D2(core &cpu) { // CLR1 dp.6
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0xBF;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_D3(core &cpu) { // BBC dp.6
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 0x40) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_D4(core &cpu) { // MOV dp+X, A
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA + cpu.regs.X), cpu.regs.A);
}


static void opcode_D5(core &cpu) { // MOV !abs+X, A
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.X;
    cpu.write8(cpu.regs.TA, cpu.regs.A);
}


static void opcode_D6(core &cpu) { // MOV !abs+Y, A
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.regs.Y;
    cpu.write8(cpu.regs.TA, cpu.regs.A);
}


static void opcode_D7(core &cpu) { // MOV [dp]+Y, A
    cpu.regs.opc_cycles = 7;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TR)) + (cpu.read8D((cpu.regs.TR) + 1) << 8);
    cpu.regs.TA = (cpu.regs.TA + cpu.regs.Y) & 0xFFFF;
    cpu.write8(cpu.regs.TA, cpu.regs.A);
}


static void opcode_D8(core &cpu) { // MOV dp, X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA), cpu.regs.X);
}


static void opcode_D9(core &cpu) { // MOV dp+Y, X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA + cpu.regs.Y), cpu.regs.X);
}


static void opcode_DA(core &cpu) { // MOVW d, YA
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA), cpu.regs.A);
    cpu.write8D((cpu.regs.TA + 1), cpu.regs.Y);
}


static void opcode_DB(core &cpu) { // MOV dp+X, Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.write8D((cpu.regs.TA + cpu.regs.X), cpu.regs.Y);
}


static void opcode_DC(core &cpu) { // DEC Y
    cpu.regs.opc_cycles = 2;
    // INS 29 ADDR MODE undefined
    cpu.regs.Y = (cpu.regs.Y - 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_DD(core &cpu) { // MOV A, Y
    cpu.regs.opc_cycles = 2;
    cpu.regs.A = cpu.regs.Y;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_DE(core &cpu) { // CBNE dp+X, r
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    // INS 19 ADDR MODE undefined
    if (cpu.regs.A != cpu.regs.TA) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_DF(core &cpu) { // DAA A
    cpu.regs.opc_cycles = 3;
    // INS 26 ADDR MODE 0
    if (cpu.regs.P.C || (cpu.regs.A > 0x99)) {
        cpu.regs.A = (cpu.regs.A + 0x60) & 0xFF;
        cpu.regs.P.C = 1;
    }
    if (cpu.regs.P.H || ((cpu.regs.A & 15) > 0x09)) {
        cpu.regs.A = (cpu.regs.A + 0x06) & 0xFF;
    }
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_E0(core &cpu) { // CLRV i
    cpu.regs.opc_cycles = 2;
    // INS 23 ADDR MODE 0
    cpu.regs.P.V = 0;
    cpu.regs.P.H = 0;
}


static void opcode_E1(core &cpu) { // TCALL 14
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65474);
    cpu.regs.PC |= cpu.read8(65475) << 8;
}


static void opcode_E2(core &cpu) { // SET1 dp.7
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 57 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR |= 0x80;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_E3(core &cpu) { // BBS dp.7, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.TA & 0x80) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_E4(core &cpu) { // MOV A, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.A = cpu.read8D(cpu.regs.TA);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_E5(core &cpu) { // MOV A, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.A = cpu.read8(cpu.regs.TA);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_E6(core &cpu) { // MOV A, (X)
    cpu.regs.opc_cycles = 3;
    cpu.regs.A = cpu.read8D(cpu.regs.X);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_E7(core &cpu) { // MOV A, [dp+X]
    cpu.regs.opc_cycles = 6;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA2 = cpu.read8D((cpu.regs.TA + cpu.regs.X)) + (cpu.read8D((cpu.regs.TA + cpu.regs.X) + 1) << 8);
    cpu.regs.A = cpu.read8(cpu.regs.TA2);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_E8(core &cpu) { // MOV A, #imm
    cpu.regs.opc_cycles = 2;
    cpu.regs.A = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_E9(core &cpu) { // MOV X, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.X = cpu.read8(cpu.regs.TA);
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_EA(core &cpu) { // NOT1 m.b
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = (cpu.regs.TA >> 13) & 7;
    cpu.regs.TA &= 0x1FFF;
    cpu.regs.TA2 = cpu.read8(cpu.regs.TA);
    // INS 45 ADDR MODE 1
    u32 mask = 1 << cpu.regs.TR;
    if (mask & cpu.regs.TA2)
        cpu.regs.TA2 &= ((~mask) & 0xFF);
    else
        cpu.regs.TA2 |= mask;
    cpu.write8(cpu.regs.TA, cpu.regs.TA2);
}


static void opcode_EB(core &cpu) { // MOV Y, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.Y = cpu.read8D(cpu.regs.TA);
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_EC(core &cpu) { // MOV Y, !abs
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.Y = cpu.read8(cpu.regs.TA);
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_ED(core &cpu) { // NOTC i
    cpu.regs.opc_cycles = 3;
    // INS 46 ADDR MODE 0
    cpu.regs.P.C = cpu.regs.P.C ? 0 : 1;
}


static void opcode_EE(core &cpu) { // POP Y
    cpu.regs.opc_cycles = 4;
    // INS 50 ADDR MODE null
    cpu.regs.SP = (cpu.regs.SP + 1) & 0xFF;
    cpu.regs.Y = cpu.read8(0x100 + cpu.regs.SP);
}


static void opcode_EF(core &cpu) { // SLEEP 
    cpu.regs.opc_cycles = 3;
    // INS 60 ADDR MODE 0
    cpu.WAI = 1;
}


static void opcode_F0(core &cpu) { // BEQ r
    cpu.regs.opc_cycles = 2;
    // INS 10 ADDR MODE undefined
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if (cpu.regs.P.Z) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_F1(core &cpu) { // TCALL 15
    cpu.regs.opc_cycles = 8;
    // INS 63 ADDR MODE 0
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC >> 8) & 0xFF);
    cpu.regs.SP &= 0xFF;
    cpu.write8(0x100 + cpu.regs.SP--, (cpu.regs.PC & 0xFF));
    cpu.regs.SP &= 0xFF;
    cpu.regs.PC = cpu.read8(65472);
    cpu.regs.PC |= cpu.read8(65473) << 8;
}


static void opcode_F2(core &cpu) { // CLR1 dp.7
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 20 ADDR MODE 22
    cpu.regs.TR = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR &= 0x7F;
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_F3(core &cpu) { // BBC dp.n, r
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D(cpu.regs.TA);
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    if ((cpu.regs.TA & 0x80) == 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_F4(core &cpu) { // MOV A, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.A = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_F5(core &cpu) { // MOV !a+X
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.A = cpu.read8((cpu.regs.TA + cpu.regs.X) & 0xFFFF);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_F6(core &cpu) { // MOV !a+Y
    cpu.regs.opc_cycles = 5;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA += cpu.read8(cpu.regs.PC++) << 8;
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.A = cpu.read8((cpu.regs.TA + cpu.regs.Y) & 0xFFFF);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_F7(core &cpu) { // MOV A, [dp]+Y
    cpu.regs.opc_cycles = 6;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8D((cpu.regs.TR)) + (cpu.read8D((cpu.regs.TR) + 1) << 8);
    cpu.regs.TA = (cpu.regs.TA + cpu.regs.Y) & 0xFFFF;
    cpu.regs.A = cpu.read8(cpu.regs.TA);
    cpu.regs.P.Z = +((cpu.regs.A) == 0);
    cpu.regs.P.N = ((cpu.regs.A) & 0x80) >> 7;
}


static void opcode_F8(core &cpu) { // MOV X, dp
    cpu.regs.opc_cycles = 3;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.X = cpu.read8D(cpu.regs.TR);
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_F9(core &cpu) { // MOV X, dp+Y
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.X = cpu.read8D(cpu.regs.TA + cpu.regs.Y);
    cpu.regs.P.Z = +((cpu.regs.X) == 0);
    cpu.regs.P.N = ((cpu.regs.X) & 0x80) >> 7;
}


static void opcode_FA(core &cpu) { // MOV dp, dp
    cpu.regs.opc_cycles = 5;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.TR = cpu.read8D(cpu.regs.TR);
    cpu.write8D((cpu.regs.TA), cpu.regs.TR);
}


static void opcode_FB(core &cpu) { // MOV Y, dp+X
    cpu.regs.opc_cycles = 4;
    cpu.regs.TA = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    cpu.regs.Y = cpu.read8D(cpu.regs.TA + cpu.regs.X);
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_FC(core &cpu) { // INC Y
    cpu.regs.opc_cycles = 2;
    // INS 36 ADDR MODE undefined
    cpu.regs.Y = (cpu.regs.Y + 1) & 0xFF;
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_FD(core &cpu) { // MOV Y, A
    cpu.regs.opc_cycles = 2;
    cpu.regs.Y = cpu.regs.A;
    cpu.regs.P.Z = +((cpu.regs.Y) == 0);
    cpu.regs.P.N = ((cpu.regs.Y) & 0x80) >> 7;
}


static void opcode_FE(core &cpu) { // DBNZ Y, r
    cpu.regs.opc_cycles = 4;
    cpu.regs.TR = cpu.read8(cpu.regs.PC++);
    cpu.regs.PC &= 0xFFFF;
    // INS 28 ADDR MODE undefined
    cpu.regs.Y = (cpu.regs.Y - 1) & 0xFF;
    if (cpu.regs.Y != 0) {
        cpu.regs.PC = (cpu.regs.PC + (u32)(i8)cpu.regs.TR) & 0xFFFF;
        cpu.regs.opc_cycles += 2;
    }
}


static void opcode_FF(core &cpu) { // STOP 
    cpu.regs.opc_cycles = 2;
    // INS 61 ADDR MODE 0
    cpu.STP = 1;
}


ins_func decoded_opcodes[0x100] = {
&opcode_00, &opcode_01, &opcode_02, &opcode_03, &opcode_04, &opcode_05, &opcode_06, &opcode_07, 
&opcode_08, &opcode_09, &opcode_0A, &opcode_0B, &opcode_0C, &opcode_0D, &opcode_0E, &opcode_0F, 
&opcode_10, &opcode_11, &opcode_12, &opcode_13, &opcode_14, &opcode_15, &opcode_16, &opcode_17, 
&opcode_18, &opcode_19, &opcode_1A, &opcode_1B, &opcode_1C, &opcode_1D, &opcode_1E, &opcode_1F, 
&opcode_20, &opcode_21, &opcode_22, &opcode_23, &opcode_24, &opcode_25, &opcode_26, &opcode_27, 
&opcode_28, &opcode_29, &opcode_2A, &opcode_2B, &opcode_2C, &opcode_2D, &opcode_2E, &opcode_2F, 
&opcode_30, &opcode_31, &opcode_32, &opcode_33, &opcode_34, &opcode_35, &opcode_36, &opcode_37, 
&opcode_38, &opcode_39, &opcode_3A, &opcode_3B, &opcode_3C, &opcode_3D, &opcode_3E, &opcode_3F, 
&opcode_40, &opcode_41, &opcode_42, &opcode_43, &opcode_44, &opcode_45, &opcode_46, &opcode_47, 
&opcode_48, &opcode_49, &opcode_4A, &opcode_4B, &opcode_4C, &opcode_4D, &opcode_4E, &opcode_4F, 
&opcode_50, &opcode_51, &opcode_52, &opcode_53, &opcode_54, &opcode_55, &opcode_56, &opcode_57, 
&opcode_58, &opcode_59, &opcode_5A, &opcode_5B, &opcode_5C, &opcode_5D, &opcode_5E, &opcode_5F, 
&opcode_60, &opcode_61, &opcode_62, &opcode_63, &opcode_64, &opcode_65, &opcode_66, &opcode_67, 
&opcode_68, &opcode_69, &opcode_6A, &opcode_6B, &opcode_6C, &opcode_6D, &opcode_6E, &opcode_6F, 
&opcode_70, &opcode_71, &opcode_72, &opcode_73, &opcode_74, &opcode_75, &opcode_76, &opcode_77, 
&opcode_78, &opcode_79, &opcode_7A, &opcode_7B, &opcode_7C, &opcode_7D, &opcode_7E, &opcode_7F, 
&opcode_80, &opcode_81, &opcode_82, &opcode_83, &opcode_84, &opcode_85, &opcode_86, &opcode_87, 
&opcode_88, &opcode_89, &opcode_8A, &opcode_8B, &opcode_8C, &opcode_8D, &opcode_8E, &opcode_8F, 
&opcode_90, &opcode_91, &opcode_92, &opcode_93, &opcode_94, &opcode_95, &opcode_96, &opcode_97, 
&opcode_98, &opcode_99, &opcode_9A, &opcode_9B, &opcode_9C, &opcode_9D, &opcode_9E, &opcode_9F, 
&opcode_A0, &opcode_A1, &opcode_A2, &opcode_A3, &opcode_A4, &opcode_A5, &opcode_A6, &opcode_A7, 
&opcode_A8, &opcode_A9, &opcode_AA, &opcode_AB, &opcode_AC, &opcode_AD, &opcode_AE, &opcode_AF, 
&opcode_B0, &opcode_B1, &opcode_B2, &opcode_B3, &opcode_B4, &opcode_B5, &opcode_B6, &opcode_B7, 
&opcode_B8, &opcode_B9, &opcode_BA, &opcode_BB, &opcode_BC, &opcode_BD, &opcode_BE, &opcode_BF, 
&opcode_C0, &opcode_C1, &opcode_C2, &opcode_C3, &opcode_C4, &opcode_C5, &opcode_C6, &opcode_C7, 
&opcode_C8, &opcode_C9, &opcode_CA, &opcode_CB, &opcode_CC, &opcode_CD, &opcode_CE, &opcode_CF, 
&opcode_D0, &opcode_D1, &opcode_D2, &opcode_D3, &opcode_D4, &opcode_D5, &opcode_D6, &opcode_D7, 
&opcode_D8, &opcode_D9, &opcode_DA, &opcode_DB, &opcode_DC, &opcode_DD, &opcode_DE, &opcode_DF, 
&opcode_E0, &opcode_E1, &opcode_E2, &opcode_E3, &opcode_E4, &opcode_E5, &opcode_E6, &opcode_E7, 
&opcode_E8, &opcode_E9, &opcode_EA, &opcode_EB, &opcode_EC, &opcode_ED, &opcode_EE, &opcode_EF, 
&opcode_F0, &opcode_F1, &opcode_F2, &opcode_F3, &opcode_F4, &opcode_F5, &opcode_F6, &opcode_F7, 
&opcode_F8, &opcode_F9, &opcode_FA, &opcode_FB, &opcode_FC, &opcode_FD, &opcode_FE, &opcode_FF, 
};

}
